{% extends "base.html" %}
{% load static %}

{% block title %}Terminal{% endblock title %}

{% block head %}

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.terminal/js/jquery.terminal.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/jquery.terminal/css/jquery.terminal.min.css" rel="stylesheet" />

{% endblock %}

{% block style %}
{% endblock %}

{% block content %}

<div id="terminal"></div>

<template id="greetings">
    REMOTE TERMINAL
</template>

{% csrf_token %}

<script>

    var uuid = localStorage.getItem('user-uuid');
    var ws = new WebSocket(
        `ws://${window.location.host}/ws/${uuid}/`
    );

    ws.onmessage = (event) => {
        console.log(event.data);
    }

    $('#terminal').terminal(
        (cmd, obj) => {

            ws.send(cmd);

            if (cmd === 'cat') {
                const img = $('<img src="https://placekitten.com/' +
                    250 + '/' + 250 + '">');
                img.on('load', obj.resume);
                obj.pause();
                obj.echo(img);
            }


        },
        {
            height: screen.height - 100,
            greetings: '[[;lime;]' + greetings.innerHTML + ']\n\n',
        });




</script>

{% endblock %}